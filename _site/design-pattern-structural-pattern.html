<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>『 读书笔记 』 设计模式总结之结构型模式 | 云在青天水在瓶</title>
  <meta name="baidu-site-verification" content="6b2f48c1baf35f9e0eb29b4455265203"/>
  <meta name="baidu-site-verification" content="hgXDOPtWLn" />
  <meta name="google-site-verification" content="YqjJD80rZQfugWoznvslaHlII_viwiMiUDEEgPTLEDw" />
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css" type="text/css" />
  <script src="/files/dc3da690b0d2a5655a8d6150862a2a07.html"></script>
  <!-- <link rel="stylesheet" href="/css/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="/css/default-min.css" type="text/css" />
  <link rel="stylesheet" href="/css/desktop-min.css" type="text/css" />
  <link rel="stylesheet" href="/css/mobile-min.css" type="text/css" />
  <link rel="shortcut icon" href="/css/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="/css/favicon.ico" mce_href="/favicon.ico" type="image/x-icon">
  <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
  <script src="/js/jquery-1.11.0.min.js" type="text/javascript"></script>
  <script src="/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
  <script src="/js/jquery.transit.min.js" type="text/javascript"></script>
  <script src="/js/common.js" type="text/javascript"></script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  
  <!-- growingIO code -->
  <script type='text/javascript'>
      var _vds = _vds || [];
      window._vds = _vds;
      (function(){
        _vds.push(['setAccountId', '9f3f34627219ccd1']);
        (function() {
          var vds = document.createElement('script');
          vds.type='text/javascript';
          vds.async = true;
          vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
  </script>
  
  <!-- 删掉 baidu spider 主动推送，无效 -->
  <!-- baidu spider initiative push -->
<!-- <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
  </script> -->
  
  <!-- google analytics push code -->
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72176628-2', 'auto');
      ga('send', 'pageview');
  </script>

</head>

<!-- meiqia plug-in -->
<!-- 
<script type='text/javascript'>
    (function(m, ei, q, i, a, j, s) {
        m[a] = m[a] || function() {
            (m[a].a = m[a].a || []).push(arguments)
        };
        j = ei.createElement(q),
            s = ei.getElementsByTagName(q)[0];
        j.async = true;
        j.charset = 'UTF-8';
        j.src = i + '?v=' + new Date().getUTCDate();
        s.parentNode.insertBefore(j, s);
    })(window, document, 'script', '//static.meiqia.com/dist/meiqia.js', '_MEIQIA');
    _MEIQIA('entId', 15857);
</script>
 -->

<body>
  <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
  html {
    /*background: #333333;*/
    background: rgb(246, 246, 246);
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
  }
  /*body { background:transparent;}*/
  @media screen and (max-width: 770px){
    body { background: rgba(255, 255, 255, 0.9); }
  }
</style>

<div id="content" class="post" style="margin-top: 20px;">
  <div id="avatar" class="avatar circle" data-in-right="false" style="width: 150px; height: 150px; position: fixed; top: 40px; z-index: 99; opacity: 0;">
    <div class="center" style="margin-top: 4px; height: 142px; width: 142px; border-radius: 71px; background-image: url('../images/2.jpg');"></div>
  </div>

  <div class="entry" style="position: relative;">
    <h1 class="entry-title"><a href="/design-pattern-structural-pattern" title="『 读书笔记 』 设计模式总结之结构型模式">『 读书笔记 』 设计模式总结之结构型模式</a></h1>    

    <p class="entry-date">2015-03-13 
        <span class="lastModified" style="display: none;" data-source="_posts/books/2015-03-13-design-pattern-structural-pattern.md">最后更新时间: 
        </span>
    </p>


    <h2 id="1-适配器模式">1. 适配器模式</h2>
<p>　　在设计模式中，适配器模式（英语：adapter pattern）有时候也称包装样式或者包装。将一个类的接口转接成用户所期待的。一个适配使得因接口不兼容而不能在一起工作的类工作在一起，做法是将类别自己的接口包裹在一个已存在的类中。</p>

<h3 id="11-python源码示例">1.1 Python源码示例</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="s">"""http://ginstrom.com/scribbles/2008/11/06/generic-adapter-class-in-python/"""</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="k">class</span> <span class="nc">Dog</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Dog"</span>
    <span class="k">def</span> <span class="nf">bark</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"woof!"</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Cat"</span>
    <span class="k">def</span> <span class="nf">meow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"meow!"</span>

<span class="k">class</span> <span class="nc">Human</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Human"</span>
    <span class="k">def</span> <span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"'hello'"</span>


<span class="k">class</span> <span class="nc">Car</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Car"</span>
    <span class="k">def</span> <span class="nf">make_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octane_level</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"vroom{0}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">"!"</span> <span class="o">*</span> <span class="n">octane_level</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Adapter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="s">"""
    Adapts an object by replacing methods.
    Usage:
    dog = Dog
    dog = Adapter(dog, dict(make_noise=dog.bark))
    &gt;&gt;&gt; objects = []
    &gt;&gt;&gt; dog = Dog()
    &gt;&gt;&gt; objects.append(Adapter(dog, make_noise=dog.bark))
    &gt;&gt;&gt; cat = Cat()
    &gt;&gt;&gt; objects.append(Adapter(cat, make_noise=cat.meow))
    &gt;&gt;&gt; human = Human()
    &gt;&gt;&gt; objects.append(Adapter(human, make_noise=human.speak))
    &gt;&gt;&gt; car = Car()
    &gt;&gt;&gt; car_noise = lambda: car.make_noise(3)
    &gt;&gt;&gt; objects.append(Adapter(car, make_noise=car_noise))
    &gt;&gt;&gt; for obj in objects:
    ...     print('A {} goes {}'.format(obj.name, obj.make_noise()))
    A Dog goes woof!
    A Cat goes meow!
    A Human goes 'hello'
    A Car goes vroom!!!
    """</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">adapted_methods</span><span class="p">):</span>
        <span class="s">"""We set the adapted methods in the object's dict"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">adapted_methods</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="s">"""All non-adapted calls are passed to the object"""</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">objects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dog</span> <span class="o">=</span> <span class="n">Dog</span><span class="p">()</span>
    <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Adapter</span><span class="p">(</span><span class="n">dog</span><span class="p">,</span> <span class="n">make_noise</span><span class="o">=</span><span class="n">dog</span><span class="o">.</span><span class="n">bark</span><span class="p">))</span>
    <span class="n">cat</span> <span class="o">=</span> <span class="n">Cat</span><span class="p">()</span>
    <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Adapter</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">make_noise</span><span class="o">=</span><span class="n">cat</span><span class="o">.</span><span class="n">meow</span><span class="p">))</span>
    <span class="n">human</span> <span class="o">=</span> <span class="n">Human</span><span class="p">()</span>
    <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Adapter</span><span class="p">(</span><span class="n">human</span><span class="p">,</span> <span class="n">make_noise</span><span class="o">=</span><span class="n">human</span><span class="o">.</span><span class="n">speak</span><span class="p">))</span>
    <span class="n">car</span> <span class="o">=</span> <span class="n">Car</span><span class="p">()</span>
    <span class="n">objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Adapter</span><span class="p">(</span><span class="n">car</span><span class="p">,</span> <span class="n">make_noise</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">car</span><span class="o">.</span><span class="n">make_noise</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"A {0} goes {1}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">make_noise</span><span class="p">()))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

<span class="c">### OUTPUT ###</span>
<span class="c"># A Dog goes woof!</span>
<span class="c"># A Cat goes meow!</span>
<span class="c"># A Human goes 'hello'</span>
<span class="c"># A Car goes vroom!!!</span></code></pre></figure>

<h2 id="2-桥接模式">2. 桥接模式</h2>
<p>　　桥接模式是软件设计模式中最复杂的模式之一，它把事物对象和其具体行为、具体特征分离开来，使它们可以各自独立的变化。事物对象仅是一个抽象的概念。如“圆形”、“三角形”归于抽象的“形状”之下，而“画圆”、“画三角”归于实现行为的“画图”类之下，然后由“形状”调用“画图”。</p>

<h3 id="21-python源码示例">2.1 Python源码示例</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="s">"""http://en.wikibooks.org/wiki/Computer_Science_Design_Patterns/Bridge_Pattern#Python"""</span>


<span class="c"># ConcreteImplementor 1/2</span>
<span class="k">class</span> <span class="nc">DrawingAPI1</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'API1.circle at {}:{} radius {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">))</span>


<span class="c"># ConcreteImplementor 2/2</span>
<span class="k">class</span> <span class="nc">DrawingAPI2</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'API2.circle at {}:{} radius {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">))</span>


<span class="c"># Refined Abstraction</span>
<span class="k">class</span> <span class="nc">CircleShape</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">drawing_api</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawing_api</span> <span class="o">=</span> <span class="n">drawing_api</span>

    <span class="c"># low-level i.e. Implementation specific</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drawing_api</span><span class="o">.</span><span class="n">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span><span class="p">)</span>

    <span class="c"># high-level i.e. Abstraction specific</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pct</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radius</span> <span class="o">*=</span> <span class="n">pct</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">shapes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">CircleShape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">DrawingAPI1</span><span class="p">()),</span>
        <span class="n">CircleShape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">DrawingAPI2</span><span class="p">())</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="n">shape</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
        <span class="n">shape</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>

<span class="c">### OUTPUT ###</span>
<span class="c"># API1.circle at 1:2 radius 7.5</span>
<span class="c"># API2.circle at 5:7 radius 27.5</span></code></pre></figure>

<h2 id="3-组合模式">3. 组合模式</h2>
<p>　　针对“部分-整体”的层次结构，使得用户对单个对象和组合对象的使用具有一致性。</p>

<h3 id="31-python源码示例">3.1 Python源码示例</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="s">"""
A class which defines a composite object which can store
hieararchical dictionaries with names.
This class is same as a hiearchical dictionary, but it
provides methods to add/access/modify children by name,
like a Composite.
Created Anand B Pillai     &lt;abpillai@gmail.com&gt;
"""</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">"Anand B Pillai"</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s">"Anand B Pillai"</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">"0.2"</span>


<span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="s">""" Normalize a string so that it can be used as an attribute
    to a Python object """</span>

    <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'-'</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'-'</span><span class="p">,</span> <span class="s">'_'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">val</span>


<span class="k">def</span> <span class="nf">denormalize</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="s">""" De-normalize a string """</span>

    <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'_'</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'_'</span><span class="p">,</span> <span class="s">'-'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">val</span>


<span class="k">class</span> <span class="nc">SpecialDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>

    <span class="s">""" A dictionary type which allows direct attribute
    access to its keys """</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check for denormalized name</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">denormalize</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">AttributeError</span><span class="p">(</span><span class="s">'no attribute named </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check for denormalized name</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="n">denormalize</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name2</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">name2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># New attribute</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


<span class="k">class</span> <span class="nc">CompositeDict</span><span class="p">(</span><span class="n">SpecialDict</span><span class="p">):</span>

    <span class="s">""" A class which works like a hierarchical dictionary.
    This class is based on the Composite design-pattern """</span>

    <span class="n">ID</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s">'id#'</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">ID</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">ID</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># Link  back to father</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_father</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">SpecialDict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check for denormalized name</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">denormalize</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Look in children list</span>
                <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">child</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">child</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">attr</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">attr</span>

                    <span class="k">raise</span> <span class="nb">AttributeError</span><span class="p">(</span><span class="s">'no attribute named </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">isRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Return whether I am a root component or not """</span>

        <span class="c"># If I don't have a parent, I am root</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_father</span>

    <span class="k">def</span> <span class="nf">isLeaf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Return whether I am a leaf component or not """</span>

        <span class="c"># I am a leaf if I have no children</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span>

    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Return the name of this ConfigInfo object """</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="k">def</span> <span class="nf">getIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="s">""" Return the index of the child ConfigInfo object 'child' """</span>

        <span class="k">if</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">getDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Return the contained dictionary """</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">""" Return the value for the property for child
        'child' with key 'key' """</span>

        <span class="c"># First get the child's dictionary</span>
        <span class="n">childDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInfoDict</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">childDict</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">childDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setProperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s">""" Set the value for the property 'key' for
        the child 'child' to 'value' """</span>

        <span class="c"># First get the child's dictionary</span>
        <span class="n">childDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInfoDict</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">childDict</span><span class="p">:</span>
            <span class="n">childDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">getChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Return the list of immediate children of this object """</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span>

    <span class="k">def</span> <span class="nf">getAllChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Return the list of all children of this object """</span>

        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="n">l</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getAllChildren</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">l</span>

    <span class="k">def</span> <span class="nf">getChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s">""" Return the immediate child object with the given name """</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">child</span>

    <span class="k">def</span> <span class="nf">findChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s">""" Return the child with the given name from the tree """</span>

        <span class="c"># Note - this returns the first child of the given name</span>
        <span class="c"># any other children with similar names down the tree</span>
        <span class="c"># is not considered.</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllChildren</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">child</span>

    <span class="k">def</span> <span class="nf">findChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s">""" Return a list of children with the given name from the tree """</span>

        <span class="c"># Note: this returns a list of all the children of a given</span>
        <span class="c"># name, irrespective of the depth of look-up.</span>

        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllChildren</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">children</span>

    <span class="k">def</span> <span class="nf">getPropertyDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Return the property dictionary """</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s">'__properties'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">getDict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">getParent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Return the person who created me """</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_father</span>

    <span class="k">def</span> <span class="nf">__setChildDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="s">""" Private method to set the dictionary of the child
        object 'child' in the internal dictionary """</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">getName</span><span class="p">()]</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">getDict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setParent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">father</span><span class="p">):</span>
        <span class="s">""" Set the parent object of myself """</span>

        <span class="c"># This should be ideally called only once</span>
        <span class="c"># by the father when creating the child :-)</span>
        <span class="c"># though it is possible to change parenthood</span>
        <span class="c"># when a new child is adopted in the place</span>
        <span class="c"># of an existing one - in that case the existing</span>
        <span class="c"># child is orphaned - see addChild and addChild2</span>
        <span class="c"># methods !</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_father</span> <span class="o">=</span> <span class="n">father</span>

    <span class="k">def</span> <span class="nf">setName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s">""" Set the name of this ConfigInfo object to 'name' """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">setDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="s">""" Set the contained dictionary """</span>

        <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s">""" Set a name value pair in the contained dictionary """</span>

        <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="s">""" Return value of an attribute from the contained dictionary """</span>

        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="s">""" Add a new child 'child' with the name 'name'.
        If the optional flag 'force' is set to True, the
        child object is overwritten if it is already there.
        This function returns the child object, whether
        new or existing """</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'Argument should be a string!'</span><span class="p">)</span>

        <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">child</span><span class="p">:</span>
            <span class="c"># print('Child %s present!' % name)</span>
            <span class="c"># Replace it if force==True</span>
            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndex</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">__setChildDict</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">child</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setChildDict</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">child</span>

    <span class="k">def</span> <span class="nf">addChild2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="s">""" Add the child object 'child'. If it is already present,
        it is overwritten by default """</span>

        <span class="n">currChild</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">currChild</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIndex</span><span class="p">(</span><span class="n">currChild</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>
                <span class="n">child</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="c"># Unset the existing child's parent</span>
                <span class="n">currChild</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">currChild</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">__setChildDict</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setChildDict</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">CompositeDict</span><span class="p">(</span><span class="s">'Window'</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="s">'Frame'</span><span class="p">)</span>
    <span class="n">tfield</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="s">'Text Field'</span><span class="p">)</span>
    <span class="n">tfield</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">'size'</span><span class="p">,</span> <span class="s">'20'</span><span class="p">)</span>

    <span class="n">btn</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="s">'Button1'</span><span class="p">)</span>
    <span class="n">btn</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">'label'</span><span class="p">,</span> <span class="s">'Submit'</span><span class="p">)</span>

    <span class="n">btn</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span><span class="s">'Button2'</span><span class="p">)</span>
    <span class="n">btn</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="s">'label'</span><span class="p">,</span> <span class="s">'Browse'</span><span class="p">)</span>

    <span class="c"># print(window)</span>
    <span class="c"># print(window.Frame)</span>
    <span class="c"># print(window.Frame.Button1)</span>
    <span class="c"># print(window.Frame.Button2)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Button1</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Button2</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

<span class="c">### OUTPUT ###</span>
<span class="c"># Submit</span>
<span class="c"># Browse</span></code></pre></figure>

<h2 id="4-修饰模式">4. 修饰模式</h2>
<p>　　修饰模式，是面向对象编程领域中，一种动态地往一个类中添加新的行为的设计模式。就功能而言，修饰模式相比生成子类更为灵活，这样可以给某个对象而不是整个类添加一些功能。通过使用修饰模式，可以在运行时扩充一个类的功能。原理是：增加一个修饰类包裹原来的类，包裹的方式一般是通过在将原来的对象作为修饰类的构造函数的参数。装饰类实现新的功能，但是，在不需要用到新功能的地方，它可以直接调用原来的类中的方法。修饰类必须和原来的类有相同的接口。修饰模式是类继承的另外一种选择。类继承在编译时候增加行为，而装饰模式是在运行时增加行为。</p>

<h3 id="41-python源码示例">4.1 Python源码示例</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="s">"""https://docs.python.org/2/library/functools.html#functools.wraps"""</span>
<span class="s">"""https://stackoverflow.com/questions/739654/how-can-i-make-a-chain-of-function-decorators-in-python/739665#739665"""</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">makebold</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">"&lt;b&gt;"</span> <span class="o">+</span> <span class="n">fn</span><span class="p">()</span> <span class="o">+</span> <span class="s">"&lt;/b&gt;"</span>
    <span class="k">return</span> <span class="n">wrapped</span>


<span class="k">def</span> <span class="nf">makeitalic</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">():</span>
        <span class="k">return</span> <span class="s">"&lt;i&gt;"</span> <span class="o">+</span> <span class="n">fn</span><span class="p">()</span> <span class="o">+</span> <span class="s">"&lt;/i&gt;"</span>
    <span class="k">return</span> <span class="n">wrapped</span>


<span class="nd">@makebold</span>
<span class="nd">@makeitalic</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="s">"""a decorated hello world"""</span>
    <span class="k">return</span> <span class="s">"hello world"</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'result:{}   name:{}   doc:{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hello</span><span class="p">(),</span> <span class="n">hello</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">hello</span><span class="o">.</span><span class="n">__doc__</span><span class="p">))</span>

<span class="c">### OUTPUT ###</span>
<span class="c"># result:&lt;b&gt;&lt;i&gt;hello world&lt;/i&gt;&lt;/b&gt;   name:hello   doc:a decorated hello world</span></code></pre></figure>

<h2 id="5-外观模式">5. 外观模式</h2>
<p>　　外观模式（Facade pattern），是软件工程中常用的一种软件设计模式，它为子系统中的一组接口提供一个统一的高层接口，使得子系统更容易使用。</p>

<h3 id="51-python源码示例">5.1 Python源码示例</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="n">SLEEP</span> <span class="o">=</span> <span class="mf">0.5</span>


<span class="c"># Complex Parts</span>
<span class="k">class</span> <span class="nc">TC1</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"###### In Test 1 ######"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Setting up"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Running test"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Tearing down"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Test Finished</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TC2</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"###### In Test 2 ######"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Setting up"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Running test"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Tearing down"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Test Finished</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TC3</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"###### In Test 3 ######"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Setting up"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Running test"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Tearing down"</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SLEEP</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Test Finished</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>


<span class="c"># Facade</span>
<span class="k">class</span> <span class="nc">TestRunner</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tc1</span> <span class="o">=</span> <span class="n">TC1</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tc2</span> <span class="o">=</span> <span class="n">TC2</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tc3</span> <span class="o">=</span> <span class="n">TC3</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tests</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tc1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tc2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tc3</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">runAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tests</span><span class="p">]</span>


<span class="c"># Client</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">testrunner</span> <span class="o">=</span> <span class="n">TestRunner</span><span class="p">()</span>
    <span class="n">testrunner</span><span class="o">.</span><span class="n">runAll</span><span class="p">()</span>

<span class="c">### OUTPUT ###</span>
<span class="c"># ###### In Test 1 ######</span>
<span class="c"># Setting up</span>
<span class="c"># Running test</span>
<span class="c"># Tearing down</span>
<span class="c"># Test Finished</span>
<span class="c">#</span>
<span class="c"># ###### In Test 2 ######</span>
<span class="c"># Setting up</span>
<span class="c"># Running test</span>
<span class="c"># Tearing down</span>
<span class="c"># Test Finished</span>
<span class="c">#</span>
<span class="c"># ###### In Test 3 ######</span>
<span class="c"># Setting up</span>
<span class="c"># Running test</span>
<span class="c"># Tearing down</span>
<span class="c"># Test Finished</span>
<span class="c">#</span></code></pre></figure>

<h2 id="扫一扫">扫一扫</h2>

<p><img src="../../images/share/2015-03-13-design-pattern-structural-pattern.md.jpg" alt="2015-03-13-design-pattern-structural-pattern.md" /></p>


    <!-- share icon -->
    <!-- <div class="ds-share" data-thread-key="/design-pattern-structural-pattern" data-title="『 读书笔记 』 设计模式总结之结构型模式"
         data-content="content"
         data-url="http://litaotao.github.io//design-pattern-structural-pattern">
        <div class="ds-share-aside-left">
          <div class="ds-share-aside-inner">
          </div>
          <div class="ds-share-aside-toggle">分享</div>
        </div>
    </div>
 -->
    <!-- 百度分享按钮 -->

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"7","bdPos":"left","bdTop":"118"},"image":{"viewList":["weixin","qzone","tsina","tqq","renren","sqq","evernotecn","youdao"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["weixin","qzone","tsina","tqq","renren","sqq","evernotecn","youdao"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>


<!--     <div id="disqus_container">
      <div style="margin-bottom:20px">
      多说评论框 start
        <div class="ds-thread" data-thread-key=/design-pattern-structural-pattern data-title=『 读书笔记 』 设计模式总结之结构型模式 
             data-url=http://localhost:4000+/design-pattern-structural-pattern></div>
      多说评论框 end
      多说公共JS代码 start (一个网页只需插入一次)
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"litaotao"};
        (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          // ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.src = '../js/embed.js'
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
      多说公共JS代码 end
      </div>
    </div> -->

        <div id="disqus_thread"></div>
            <script>

            /**
            *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
            /*
            var disqus_config = function () {
            this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
            */
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://litaotao-github-io.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>    

  </div>
  
  <div id="menuIndex" class="sidenav">
    <div class="myinfo">
        <center>
          <div id="avatarHolder" class="avatar circle" style="width: 0px; height: 0px; box-shadow: none; margin-bottom: 20px;">
          </div>
          <a href="/index.html" title="Homepage"><i class="icon-home icon-large"></i> Home</a>
          <a href="http://www.linkedin.com/in/taotaoli"><i class="icon-linkedin-sign icon-large"></i> Linkedin</a>
          <a href="https://github.com/zxy"><i class="icon-github icon-large"></i> Code</a>
          <a href="mailto:1757943205@qq.com"><i class="icon-envelope icon-large"></i> Mail</a>
          <button id="present_button" onclick="present_mode()" style="width: 100%; margin-top: 10px; display: none"><i class="icon-align-justify icon-large"></i> Present Mode</button>
        </center>
    </div>
    <div id="menu"></div>
  </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>
<script type="text/javascript">
    //博文页面也做一下刷新操作，避免有时候切换横竖屏时格式不对的问题  
    // $( window ).resize(function() { 
    //     location.reload(); 
    // });
</script>


  <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1258855744'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1258855744' type='text/javascript'%3E%3C/script%3E"));
  </script>

</body>
</html>
