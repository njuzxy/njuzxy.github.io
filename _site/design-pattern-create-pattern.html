<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>『 读书笔记 』 设计模式总结之创建型模式 | 云在青天水在瓶</title>
  <meta name="baidu-site-verification" content="6b2f48c1baf35f9e0eb29b4455265203"/>
  <meta name="baidu-site-verification" content="hgXDOPtWLn" />
  <meta name="google-site-verification" content="YqjJD80rZQfugWoznvslaHlII_viwiMiUDEEgPTLEDw" />
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css" type="text/css" />
  <script src="/files/dc3da690b0d2a5655a8d6150862a2a07.html"></script>
  <!-- <link rel="stylesheet" href="/css/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="/css/default-min.css" type="text/css" />
  <link rel="stylesheet" href="/css/desktop-min.css" type="text/css" />
  <link rel="stylesheet" href="/css/mobile-min.css" type="text/css" />
  <link rel="shortcut icon" href="/css/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="/css/favicon.ico" mce_href="/favicon.ico" type="image/x-icon">
  <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
  <script src="/js/jquery-1.11.0.min.js" type="text/javascript"></script>
  <script src="/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
  <script src="/js/jquery.transit.min.js" type="text/javascript"></script>
  <script src="/js/common.js" type="text/javascript"></script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  
  <!-- growingIO code -->
  <script type='text/javascript'>
      var _vds = _vds || [];
      window._vds = _vds;
      (function(){
        _vds.push(['setAccountId', '9f3f34627219ccd1']);
        (function() {
          var vds = document.createElement('script');
          vds.type='text/javascript';
          vds.async = true;
          vds.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'dn-growing.qbox.me/vds.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(vds, s);
        })();
      })();
  </script>
  
  <!-- 删掉 baidu spider 主动推送，无效 -->
  <!-- baidu spider initiative push -->
<!-- <script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
  </script> -->
  
  <!-- google analytics push code -->
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72176628-2', 'auto');
      ga('send', 'pageview');
  </script>

</head>

<!-- meiqia plug-in -->
<!-- 
<script type='text/javascript'>
    (function(m, ei, q, i, a, j, s) {
        m[a] = m[a] || function() {
            (m[a].a = m[a].a || []).push(arguments)
        };
        j = ei.createElement(q),
            s = ei.getElementsByTagName(q)[0];
        j.async = true;
        j.charset = 'UTF-8';
        j.src = i + '?v=' + new Date().getUTCDate();
        s.parentNode.insertBefore(j, s);
    })(window, document, 'script', '//static.meiqia.com/dist/meiqia.js', '_MEIQIA');
    _MEIQIA('entId', 15857);
</script>
 -->

<body>
  <link rel="stylesheet" href="/js/prettify/prettify.css" />
<style type="text/css">
  html {
    /*background: #333333;*/
    background: rgb(246, 246, 246);
    -webkit-background-size: cover;
    -moz-background-size: cover;
    -o-background-size: cover;
    background-size: cover;
  }
  /*body { background:transparent;}*/
  @media screen and (max-width: 770px){
    body { background: rgba(255, 255, 255, 0.9); }
  }
</style>

<div id="content" class="post" style="margin-top: 20px;">
  <div id="avatar" class="avatar circle" data-in-right="false" style="width: 150px; height: 150px; position: fixed; top: 40px; z-index: 99; opacity: 0;">
    <div class="center" style="margin-top: 4px; height: 142px; width: 142px; border-radius: 71px; background-image: url('../images/2.jpg');"></div>
  </div>

  <div class="entry" style="position: relative;">
    <h1 class="entry-title"><a href="/design-pattern-create-pattern" title="『 读书笔记 』 设计模式总结之创建型模式">『 读书笔记 』 设计模式总结之创建型模式</a></h1>    

    <p class="entry-date">2015-03-11 
        <span class="lastModified" style="display: none;" data-source="_posts/books/2015-03-11-design-pattern-create-pattern.md">最后更新时间: 
        </span>
    </p>


    <h2 id="1-抽象工厂模式">1. 抽象工厂模式</h2>
<p>　　抽象工厂模式（英语：Abstract factory pattern）是一种软件开发设计模式。抽象工厂模式提供了一种方式，可以将一组具有同一主题的单独的工厂封装起来。在正常使用中，客户端程序需要创建抽象工厂的具体实现，然后使用抽象工厂作为接口来创建这一主题的具体对象。客户端程序不需要知道（或关心）它从这些内部的工厂方法中获得对象的具体类型，因为客户端程序仅使用这些对象的通用接口。抽象工厂模式将一组对象的实现细节与他们的一般使用分离开来。</p>

<p>　　举个例子来说，比如一个抽象工厂类叫做DocumentCreator（文档创建器），此类提供创建若干种产品的接口，包括createLetter()（创建邮件）和createResume()（创建简历）。其中，createLetter()返回一个Letter（邮件），createResume()返回一个Resume（简历）。系统中还有一些DocumentCreator的具体实现类，包括FancyDocumentCreator和ModernDocumentCreator。这两个类对DocumentCreator的两个方法分别有不同的实现，用来创建不同的“邮件”和“简历”（用FancyDocumentCreator的实例可以创建FancyLetter和FancyResume，用ModernDocumentCreator的实例可以创建ModernLetter和ModernResume）。这些具体的“邮件”和“简历”类均继承自抽象类，即Letter和Resume类。客户端需要创建“邮件”或“简历”时，先要得到一个合适的DocumentCreator实例，然后调用它的方法。一个工厂中创建的每个对象都是同一个主题的（“fancy”或者“modern”）。客户端程序只需要知道得到的对象是“邮件”或者“简历”，而不需要知道具体的主题，因此客户端程序从抽象工厂DocumentCreator中得到了Letter或Resume类的引用，而不是具体类的对象引用。</p>

<p>　　“工厂”是创建产品（对象）的地方，其目的是将产品的创建与产品的使用分离。抽象工厂模式的目的，是将若干抽象产品的接口与不同主题产品的具体实现分离开。这样就能在增加新的具体工厂的时候，不用修改引用抽象工厂的客户端代码。</p>

<p>　　使用抽象工厂模式，能够在具体工厂变化的时候，不用修改使用工厂的客户端代码，甚至是在运行时。然而，使用这种模式或者相似的设计模式，可能给编写代码带来不必要的复杂性和额外的工作。正确使用设计模式能够抵消这样的“额外工作”。</p>

<h3 id="11-python-源码示例">1.1 Python 源码示例</h3>

<p>　　源码来自<a href="https://github.com/faif/python-patterns/">github:python-patterns</a></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># http://ginstrom.com/scribbles/2007/10/08/design-patterns-python-style/</span>

<span class="s">"""Implementation of the abstract factory pattern"""</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="k">class</span> <span class="nc">PetShop</span><span class="p">:</span>

    <span class="s">"""A pet shop"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">animal_factory</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">"""pet_factory is our abstract factory.  We can set it at will."""</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pet_factory</span> <span class="o">=</span> <span class="n">animal_factory</span>

    <span class="k">def</span> <span class="nf">show_pet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Creates and shows a pet using the abstract factory"""</span>

        <span class="n">pet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pet_factory</span><span class="o">.</span><span class="n">get_pet</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"We have a lovely {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pet</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"It says {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pet</span><span class="o">.</span><span class="n">speak</span><span class="p">()))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"We also have {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pet_factory</span><span class="o">.</span><span class="n">get_food</span><span class="p">()))</span>


<span class="c"># Stuff that our factory makes</span>

<span class="k">class</span> <span class="nc">Dog</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"woof"</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"Dog"</span>


<span class="k">class</span> <span class="nc">Cat</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"meow"</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"Cat"</span>


<span class="c"># Factory classes</span>

<span class="k">class</span> <span class="nc">DogFactory</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">get_pet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_food</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"dog food"</span>


<span class="k">class</span> <span class="nc">CatFactory</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">get_pet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Cat</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_food</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"cat food"</span>

<span class="c"># Create the proper family</span>
<span class="k">def</span> <span class="nf">get_factory</span><span class="p">():</span>
    <span class="s">"""Let's be dynamic!"""</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">DogFactory</span><span class="p">,</span> <span class="n">CatFactory</span><span class="p">])()</span>


<span class="c"># Show pets with various factories</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">shop</span> <span class="o">=</span> <span class="n">PetShop</span><span class="p">(</span><span class="n">get_factory</span><span class="p">())</span>
        <span class="n">shop</span><span class="o">.</span><span class="n">show_pet</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"="</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>

<span class="c">### OUTPUT ###</span>
<span class="c"># We have a lovely Dog</span>
<span class="c"># It says woof</span>
<span class="c"># We also have dog food</span>
<span class="c"># ====================</span>
<span class="c"># We have a lovely Dog</span>
<span class="c"># It says woof</span>
<span class="c"># We also have dog food</span>
<span class="c"># ====================</span>
<span class="c"># We have a lovely Cat</span>
<span class="c"># It says meow</span>
<span class="c"># We also have cat food</span>
<span class="c"># ====================</span></code></pre></figure>

<h2 id="2工厂方法模式">2.工厂方法模式</h2>
<p>　　工厂方法模式（英语：Factory method pattern）是一种实现了“工厂”概念的面向对象设计模式。就像其他创建型模式一样，它也是处理在不指定对象具体类型的情况下创建对象的问题。工厂方法模式的实质是“定义一个创建对象的接口，但让实现这个接口的类来决定实例化哪个类。工厂方法让类的实例化推迟到子类中进行。”</p>

<p>　　创建一个对象常常需要复杂的过程，所以不适合包含在一个复合对象中。创建对象可能会导致大量的重复代码，可能会需要复合对象访问不到的信息，也可能提供不了足够级别的抽象，还可能并不是复合对象概念的一部分。工厂方法模式通过定义一个单独的创建对象的方法来解决这些问题。由子类实现这个方法来创建具体类型的对象。</p>

<p>　　对象创建中的有些过程包括决定创建哪个对象、管理对象的生命周期，以及管理特定对象的创建和销毁的概念。</p>

<p>　　如果抛开设计模式的范畴，“工厂方法”这个词也可以指作为“工厂”的方法，这个方法的主要目的就是创建对象，而这个方法不一定在单独的工厂类中。这些方法通常作为静态方法，定义在方法所实例化的类中。</p>

<p>　　每个工厂方法都有特定的名称。在许多面向对象的编程语言中，构造方法必须和它所在的类具有相同的名称，这样的话，如果有多种创建对象的方式（重载）就可能导致歧义。工厂方法没有这种限制，所以可以具有描述性的名称。举例来说，根据两个实数创建一个复数，而这两个实数表示直角坐标或极坐标，如果使用工厂方法，方法的含义就非常清晰了。当工厂方法起到这种消除歧义的作用时，构造方法常常被设置为私有方法，从而强制客户端代码使用工厂方法创建对象。</p>

<h3 id="21-python-源码示例">2.1 Python 源码示例</h3>

<p>　　源码来自<a href="https://github.com/faif/python-patterns/">github:python-patterns</a></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="s">"""http://ginstrom.com/scribbles/2007/10/08/design-patterns-python-style/"""</span>


<span class="k">class</span> <span class="nc">GreekGetter</span><span class="p">:</span>

    <span class="s">"""A simple localizer a la gettext"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dog</span><span class="o">=</span><span class="s">"σκύλος"</span><span class="p">,</span> <span class="n">cat</span><span class="o">=</span><span class="s">"γάτα"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgid</span><span class="p">):</span>
        <span class="s">"""We'll punt if we don't have a translation"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="p">[</span><span class="n">msgid</span><span class="p">]</span>
        <span class="k">except</span> <span class="nb">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">msgid</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EnglishGetter</span><span class="p">:</span>

    <span class="s">"""Simply echoes the msg ids"""</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgid</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">msgid</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_localizer</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s">"English"</span><span class="p">):</span>
    <span class="s">"""The factory method"""</span>
    <span class="n">languages</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">English</span><span class="o">=</span><span class="n">EnglishGetter</span><span class="p">,</span> <span class="n">Greek</span><span class="o">=</span><span class="n">GreekGetter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">languages</span><span class="p">[</span><span class="n">language</span><span class="p">]()</span>

<span class="c"># Create our localizers</span>
<span class="n">e</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">get_localizer</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s">"English"</span><span class="p">),</span> <span class="n">get_localizer</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="s">"Greek"</span><span class="p">)</span>
<span class="c"># Localize some text</span>
<span class="k">for</span> <span class="n">msgid</span> <span class="ow">in</span> <span class="s">"dog parrot cat bear"</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">msgid</span><span class="p">),</span> <span class="n">g</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">msgid</span><span class="p">))</span>

<span class="c">### OUTPUT ###</span>
<span class="c"># dog σκύλος</span>
<span class="c"># parrot parrot</span>
<span class="c"># cat γάτα</span>
<span class="c"># bear bear</span></code></pre></figure>

<h2 id="3-单例模式">3. 单例模式</h2>
<p>　　单例模式，也叫单子模式，是一种常用的软件设计模式。在应用这个模式时，单例对象的类必须保证只有一个实例存在。许多时候整个系统只需要拥有一个的全局对象，这样有利于我们协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息。这种方式简化了在复杂环境下的配置管理。</p>

<p>　　实现单例模式的思路是：一个类能返回对象一个引用(永远是同一个)和一个获得该实例的方法（必须是静态方法，通常使用getInstance这个名称）；当我们调用这个方法时，如果类持有的引用不为空就返回这个引用，如果类保持的引用为空就创建该类的实例并将实例的引用赋予该类保持的引用；同时我们还将该类的构造函数定义为私有方法，这样其他处的代码就无法通过调用该类的构造函数来实例化该类的对象，只有通过该类提供的静态方法来得到该类的唯一实例。</p>

<p>　　单例模式在多线程的应用场合下必须小心使用。如果当唯一实例尚未创建时，有两个线程同时调用创建方法，那么它们同时没有检测到唯一实例的存在，从而同时各自创建了一个实例，这样就有两个实例被构造出来，从而违反了单例模式中实例唯一的原则。 解决这个问题的办法是为指示类是否已经实例化的变量提供一个互斥锁(虽然这样会降低效率)。</p>

<h3 id="31-python源码示例">3.1 Python源码示例</h3>
<p>　　源码来自<a href="http://blog.csdn.net/ghostfromheaven/article/details/7671853">csdn.net</a></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#-*- encoding=utf-8 -*-</span>
<span class="k">print</span> <span class="s">'----------------------方法1--------------------------'</span>
<span class="c">#方法1,实现__new__方法</span>
<span class="c">#并在将一个类的实例绑定到类变量_instance上,</span>
<span class="c">#如果cls._instance为None说明该类还没有实例化过,实例化该类,并返回</span>
<span class="c">#如果cls._instance不为None,直接返回cls._instance</span>
<span class="k">class</span> <span class="nc">Singleton</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">'_instance'</span><span class="p">):</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Singleton</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="n">orig</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span>

<span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="n">Singleton</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>
<span class="n">two</span> <span class="o">=</span> <span class="n">MyClass</span><span class="p">()</span>

<span class="n">two</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">print</span> <span class="n">one</span><span class="o">.</span><span class="n">a</span>
<span class="c">#3</span>
<span class="c">#one和two完全相同,可以用id(), ==, is检测</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
<span class="c">#29097904</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">two</span><span class="p">)</span>
<span class="c">#29097904</span>
<span class="k">print</span> <span class="n">one</span> <span class="o">==</span> <span class="n">two</span>
<span class="c">#True</span>
<span class="k">print</span> <span class="n">one</span> <span class="ow">is</span> <span class="n">two</span>
<span class="c">#True</span>

<span class="k">print</span> <span class="s">'----------------------方法2--------------------------'</span>
<span class="c">#方法2,共享属性;所谓单例就是所有引用(实例、对象)拥有相同的状态(属性)和行为(方法)</span>
<span class="c">#同一个类的所有实例天然拥有相同的行为(方法),</span>
<span class="c">#只需要保证同一个类的所有实例具有相同的状态(属性)即可</span>
<span class="c">#所有实例共享属性的最简单最直接的方法就是__dict__属性指向(引用)同一个字典(dict)</span>
<span class="c">#可参看:http://code.activestate.com/recipes/66531/</span>
<span class="k">class</span> <span class="nc">Borg</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">ob</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Borg</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">ob</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_state</span>
        <span class="k">return</span> <span class="n">ob</span>

<span class="k">class</span> <span class="nc">MyClass2</span><span class="p">(</span><span class="n">Borg</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">MyClass2</span><span class="p">()</span>
<span class="n">two</span> <span class="o">=</span> <span class="n">MyClass2</span><span class="p">()</span>

<span class="c">#one和two是两个不同的对象,id, ==, is对比结果可看出</span>
<span class="n">two</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">print</span> <span class="n">one</span><span class="o">.</span><span class="n">a</span>
<span class="c">#3</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
<span class="c">#28873680</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">two</span><span class="p">)</span>
<span class="c">#28873712</span>
<span class="k">print</span> <span class="n">one</span> <span class="o">==</span> <span class="n">two</span>
<span class="c">#False</span>
<span class="k">print</span> <span class="n">one</span> <span class="ow">is</span> <span class="n">two</span>
<span class="c">#False</span>
<span class="c">#但是one和two具有相同的（同一个__dict__属性）,见:</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">one</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
<span class="c">#30104000</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">two</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
<span class="c">#30104000</span>

<span class="k">print</span> <span class="s">'----------------------方法3--------------------------'</span>
<span class="c">#方法3:本质上是方法1的升级（或者说高级）版</span>
<span class="c">#使用__metaclass__（元类）的高级python用法</span>
<span class="k">class</span> <span class="nc">Singleton2</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Singleton2</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Singleton2</span><span class="p">,</span> <span class="n">cls</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_instance</span>

<span class="k">class</span> <span class="nc">MyClass3</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">Singleton2</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">MyClass3</span><span class="p">()</span>
<span class="n">two</span> <span class="o">=</span> <span class="n">MyClass3</span><span class="p">()</span>

<span class="n">two</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">print</span> <span class="n">one</span><span class="o">.</span><span class="n">a</span>
<span class="c">#3</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
<span class="c">#31495472</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">two</span><span class="p">)</span>
<span class="c">#31495472</span>
<span class="k">print</span> <span class="n">one</span> <span class="o">==</span> <span class="n">two</span>
<span class="c">#True</span>
<span class="k">print</span> <span class="n">one</span> <span class="ow">is</span> <span class="n">two</span>
<span class="c">#True</span>

<span class="k">print</span> <span class="s">'----------------------方法4--------------------------'</span>
<span class="c">#方法4:也是方法1的升级（高级）版本,</span>
<span class="c">#使用装饰器(decorator),</span>
<span class="c">#这是一种更pythonic,更elegant的方法,</span>
<span class="c">#单例类本身根本不知道自己是单例的,因为他本身(自己的代码)并不是单例的</span>
<span class="k">def</span> <span class="nf">singleton</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">_singleton</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">:</span>
            <span class="n">instances</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instances</span><span class="p">[</span><span class="n">cls</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">_singleton</span>

<span class="nd">@singleton</span>
<span class="k">class</span> <span class="nc">MyClass4</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

<span class="n">one</span> <span class="o">=</span> <span class="n">MyClass4</span><span class="p">()</span>
<span class="n">two</span> <span class="o">=</span> <span class="n">MyClass4</span><span class="p">()</span>

<span class="n">two</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">print</span> <span class="n">one</span><span class="o">.</span><span class="n">a</span>
<span class="c">#3</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">one</span><span class="p">)</span>
<span class="c">#29660784</span>
<span class="k">print</span> <span class="nb">id</span><span class="p">(</span><span class="n">two</span><span class="p">)</span>
<span class="c">#29660784</span>
<span class="k">print</span> <span class="n">one</span> <span class="o">==</span> <span class="n">two</span>
<span class="c">#True</span>
<span class="k">print</span> <span class="n">one</span> <span class="ow">is</span> <span class="n">two</span>
<span class="c">#True</span>
<span class="n">one</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">print</span> <span class="n">one</span><span class="o">.</span><span class="n">x</span>
<span class="c">#1</span>
<span class="k">print</span> <span class="n">two</span><span class="o">.</span><span class="n">x</span>
<span class="c">#1</span></code></pre></figure>

<h2 id="扫一扫">扫一扫</h2>

<p><img src="../../images/share/2015-03-11-design-pattern-create-pattern.md.jpg" alt="2015-03-11-design-pattern-create-pattern.md" /></p>


    <!-- share icon -->
    <!-- <div class="ds-share" data-thread-key="/design-pattern-create-pattern" data-title="『 读书笔记 』 设计模式总结之创建型模式"
         data-content="content"
         data-url="http://litaotao.github.io//design-pattern-create-pattern">
        <div class="ds-share-aside-left">
          <div class="ds-share-aside-inner">
          </div>
          <div class="ds-share-aside-toggle">分享</div>
        </div>
    </div>
 -->
    <!-- 百度分享按钮 -->

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"7","bdPos":"left","bdTop":"118"},"image":{"viewList":["weixin","qzone","tsina","tqq","renren","sqq","evernotecn","youdao"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["weixin","qzone","tsina","tqq","renren","sqq","evernotecn","youdao"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>


<!--     <div id="disqus_container">
      <div style="margin-bottom:20px">
      多说评论框 start
        <div class="ds-thread" data-thread-key=/design-pattern-create-pattern data-title=『 读书笔记 』 设计模式总结之创建型模式 
             data-url=http://localhost:4000+/design-pattern-create-pattern></div>
      多说评论框 end
      多说公共JS代码 start (一个网页只需插入一次)
      <script type="text/javascript">
      var duoshuoQuery = {short_name:"litaotao"};
        (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          // ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
          ds.src = '../js/embed.js'
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
      多说公共JS代码 end
      </div>
    </div> -->

        <div id="disqus_thread"></div>
            <script>

            /**
            *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
            /*
            var disqus_config = function () {
            this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
            */
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://litaotao-github-io.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>    

  </div>
  
  <div id="menuIndex" class="sidenav">
    <div class="myinfo">
        <center>
          <div id="avatarHolder" class="avatar circle" style="width: 0px; height: 0px; box-shadow: none; margin-bottom: 20px;">
          </div>
          <a href="/index.html" title="Homepage"><i class="icon-home icon-large"></i> Home</a>
          <a href="http://www.linkedin.com/in/taotaoli"><i class="icon-linkedin-sign icon-large"></i> Linkedin</a>
          <a href="https://github.com/zxy"><i class="icon-github icon-large"></i> Code</a>
          <a href="mailto:1757943205@qq.com"><i class="icon-envelope icon-large"></i> Mail</a>
          <button id="present_button" onclick="present_mode()" style="width: 100%; margin-top: 10px; display: none"><i class="icon-align-justify icon-large"></i> Present Mode</button>
        </center>
    </div>
    <div id="menu"></div>
  </div>
</div>

<script src="/js/post.js" type="text/javascript"></script>
<script type="text/javascript">
    //博文页面也做一下刷新操作，避免有时候切换横竖屏时格式不对的问题  
    // $( window ).resize(function() { 
    //     location.reload(); 
    // });
</script>


  <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1258855744'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1258855744' type='text/javascript'%3E%3C/script%3E"));
  </script>

</body>
</html>
